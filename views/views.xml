<openerp>
  <data>
    <!-- Financiera descubierto - lista -->
    
    <record model="ir.ui.view" id="descubierto_list">
      <field name="name">Descubierto list</field>
      <field name="model">financiera.descubierto</field>
      <field name="arch" type="xml">
        <tree>
          <field name="date"/>
          <field name="partner_id"/>
          <field name="name"/>
          <field name="date_start"/>
          <field name="date_finish"/>
          <field name="state"/>
        </tree>
      </field>
    </record>

    <!-- Financiera descubierto - formulario -->

    <record model="ir.ui.view" id="descubierto_form">
      <field name="name">Descubierto form</field>
      <field name="model">financiera.descubierto</field>
      <field name="arch" type="xml">
        <form>
          <header>
            <button name="create_saldo_mes" class="oe_highlight" string="Comprobar meses" type="object" />
            <button name="procesar" class="oe_highlight" states="borrador" string="Computar interes" type="object" />
            <button name="draft" states="procesando,cancelado" string="A borrador" type="object" />
            <button name="wizard_descubierto_facturar" states="procesando" string="Facturar" type="object" class="oe_highlight" />
            <button name="wizard_cancelar" states="facturado" string="Cancelar" type="object" />
            <field name="state" widget="statusbar"/>
          </header>
          <sheet>
            <group>
              <group>
                <field name="id"/>
                <field name="date" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                <field name="partner_id" options="{'no_quick_create':True,'no_create_edit':True}" domain="[('customer', '=', True)]" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                <field name="account_id" options="{'no_quick_create': True,'no_create_edit': True}"/>
                <field name="is_credit"/>
                <field name="credit" attrs="{'invisible': [('is_credit', '=', False)]}" readonly="1"/>
                <field name="debit" attrs="{'invisible': [('is_credit', '=', True)]}" readonly="1"/>
                <field name="currency_id"/>
              </group>
              <group>
                <field name="date_start" attrs="{'readonly': True}"/>
                <field name="date_finish" attrs="{'readonly': [('state', '!=', 'borrador')], 'required': True}"/>
                <field name="capitalization" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                <field name="rate_per_day" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                <field name="vat_tax" attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                <field name="vat_tax_id" attrs="{'readonly': [('state', '!=', 'borrador')], 'invisible': [('vat_tax', '=', False)], 'required': [('vat_tax', '=', True)]}"/>
              </group>
            </group>
            <notebook>
              <page string="Movimientos">
                <field name="line_ids">
                  <tree  create="false" delete="false" editable="true">
                    <field name="date" readonly="1"/>
                    <field name="name" readonly="1"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="debit" sum="Debe" readonly="1"/>
                    <field name="credit" sum="Haber" readonly="1"/>
                    <field name="total_balance_receivable" readonly="1"/>
                    <field name="interes_computado" readonly="1"/>
                  </tree>
                </field>
              </page>
              <page string="Facturas">
                <field name="invoice_ids" attrs="{'readonly': True}">
                  <tree decoration-muted="state == 'cancel'">
                    <field name="date"/>
                    <field name="display_name"/>
                    <field name="amount_total"/>
                    <field name="state"/>
                  </tree>
                </field>
              </page>
              <page string="Otra informacion">
                <field name="move_ids" attrs="{'readonly': True}"/>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <!-- actions opening views on models -->
    
    <record model="ir.actions.act_window" id="financiera_descubierto_list_action">
      <field name="name">Descubierto</field>
      <field name="res_model">financiera.descubierto</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="descubierto_list"/>
    </record>

    <!-- Top menu item -->
    <menuitem name="Interes en cuenta" web_icon="financiera_interes_cuenta,static/description/icon.png" id="menu_financiera_descubierto" action="financiera_descubierto_list_action"/>

    <!-- Vista Form Partner -->

    <record id="partner_form_cuenta_corriente_inherited"  model="ir.ui.view">
      <field name="name">Extension Partner form</field>
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="base.view_partner_form"/>
      <field name="arch" type="xml">
        <xpath expr="//page[3]" position='before'>
          <page string='Interes en cuenta'>
            <group string="Informacion por defecto">
              <field name="last_date_compute_interes"/>
              <field name="date_first_move"/>
              <field name="capitalization"/>
              <field name="rate_per_day"/>
              <field name="compute_fin_mes"/>
              <field name="journal_fin_de_mes" attrs="{'invisible': [('compute_fin_mes', '=', False)], 'required': [('compute_fin_mes', '=', True)]}"/>
              <label for="create_move_fin_de_mes" string=""/><h3><button name="create_move_fin_de_mes" string="Crear movimiento de fin de mes" type="object"/></h3>
            </group>
          </page>
        </xpath>

      </field>
    </record>


    <!-- Vista Tree Account Debt Line -->

    <record id="account_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Acc Move Line Tree</field>
      <field name="model">account.move.line</field>
      <field name="inherit_id" ref="financiera_base.view_ctacte_cliente"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='total_balance_receivable']" position="after">
          <field name="interes_no_consolidado_amount" sum="Intereses"/>
          <field name="interes_computado"/>
          <field name="interes_no_consolidado_acumulado"/>
          <field name="dias"/>
          <field name="balance_anterior"/>
        </xpath>
      </field>
    </record>

  </data>
</openerp>